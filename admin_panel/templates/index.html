<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        async function markHandled(type, key, btn) {
            const formData = new FormData();
            formData.append("type", type);
            formData.append("key", key);

            const res = await fetch("/mark_handled", {
                method: "POST",
                body: formData
            });

            if (res.ok) {
                btn.disabled = true;
                btn.innerText = "‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ";
                btn.classList.add("done");
            }
        }

        async function sendBroadcastNow(btn) {
            btn.disabled = true;
            btn.innerText = "‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...";
            const res = await fetch("/send_broadcast_now", { method: "POST" });
            if (res.ok) {
                btn.innerText = "‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ";
            } else {
                btn.innerText = "‚ö†Ô∏è –û—à–∏–±–∫–∞";
                btn.disabled = false;
            }
        }
    </script>
    <style>
        body {
            font-family: sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f9f9f9;
        }

        h1, h2 {
            margin-top: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 6px 10px;
            text-align: left;
        }

        input[type="text"],
        input[type="url"],
        input[type="date"],
        textarea {
            width: 100%;
            max-width: 100%;
            padding: 6px;
            margin: 6px 0;
            box-sizing: border-box;
        }

        form {
            margin-top: 20px;
        }

        button {
            padding: 8px 14px;
            margin-top: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        button.done {
            background-color: #8bc34a;
            color: white;
        }

        .send-buttons {
            display: flex;
            gap: 12px;
        }
    </style>
</head>
<body>
    <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

    <h2>‚úàÔ∏è –ó–∞—è–≤–∫–∏ –Ω–∞ —Ç—É—Ä—ã</h2>
    <form method="get" action="/">
        <label>–° –¥–∞—Ç—ã: <input type="date" name="from_date" value="{{ from_date }}"></label>
        <label>–ø–æ –¥–∞—Ç—É: <input type="date" name="to_date" value="{{ to_date }}"></label>
        <label><input type="checkbox" name="only_new" {% if only_new %}checked{% endif %}> –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ</label>
        <button type="submit">üîç –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
    </form>

    <table>
        <tr>
            <th>–î–∞—Ç–∞</th><th>–ò–º—è</th><th>Telegram ID</th><th>–°—Ç—Ä–∞–Ω–∞</th><th>–°</th><th>–ü–æ</th><th>–ß–µ–ª.</th><th>–ë—é–¥–∂–µ—Ç</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th><th></th>
        </tr>
        {% for row, handled in tours %}
        <tr>
            {% for cell in row %}
            <td>{{ cell }}</td>
            {% endfor %}
            <td>
                {% if handled %}
                <button class="done" disabled>‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</button>
                {% else %}
                <button onclick="markHandled('tours', '{{ row[0] + row[2] }}', this)">üü¢ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>üè® –ó–∞—è–≤–∫–∏ –Ω–∞ –æ—Ç–µ–ª–∏</h2>
    <table>
        <tr>
            <th>–î–∞—Ç–∞</th><th>–ò–º—è</th><th>Telegram ID</th><th>–ì–æ—Ä–æ–¥</th><th>–°</th><th>–ü–æ</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th><th></th>
        </tr>
        {% for row, handled in hotels %}
        <tr>
            {% for cell in row %}
            <td>{{ cell }}</td>
            {% endfor %}
            <td>
                {% if handled %}
                <button class="done" disabled>‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</button>
                {% else %}
                <button onclick="markHandled('hotels', '{{ row[0] + row[2] }}', this)">üü¢ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>üî• –†–∞—Å—Å—ã–ª–∫–∞ –≥–æ—Ä—è—â–µ–≥–æ —Ç—É—Ä–∞</h2>
    <form method="post" action="/broadcast">
        <input type="text" name="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required><br>
        <textarea name="message" rows="4" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç—É—Ä–∞..." required></textarea><br>
        <input type="url" name="image_url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"><br>
        <div class="send-buttons">
            <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
            <button type="button" onclick="sendBroadcastNow(this)">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
        </div>
    </form>
</body>
</html>
